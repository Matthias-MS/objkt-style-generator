<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objkt Style AI Generator</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gifshot/0.4.5/gifshot.min.js"></script>

<style>
@keyframes pulse-soft {0%,100%{opacity:1;}50%{opacity:0.7;}}
.loading-pulse{animation:pulse-soft 2s infinite;}

@keyframes blink-red {0%,50%,100%{opacity:1;transform:scale(1);}25%,75%{opacity:0.3;transform:scale(0.98);}}
.error-blink{animation:blink-red 0.6s ease-in-out 2;}
</style>
</head>

<body class="bg-gray-50 text-gray-900 font-sans min-h-screen">
<div class="max-w-3xl mx-auto py-12 px-4">

<header class="text-center mb-12">
<h1 class="text-4xl font-extrabold tracking-tight mb-2">
Objkt Artist Style Gen<span class="align-super text-sm ml-1">by MNTG</span>
</h1>
<p class="text-gray-500">
Erstelle transformative KI-Kunst basierend auf dem Stil eines Objkt-Artists.
</p>
</header>

<div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 border border-gray-100">
<div class="space-y-6">

<div>
<label class="block text-sm font-medium text-gray-700 mb-2">
Objkt Artist Profile Link oder tz-/KT-Adresse:
</label>
<input type="text" id="artistUrl"
placeholder="https://objkt.com/users/... oder tz1..."
class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition">
</div>

<div class="grid grid-cols-2 gap-4">
<button id="modeImage" onclick="setMode('image')"
class="py-3 px-4 rounded-xl border-2 transition font-medium border-indigo-600 bg-indigo-50 text-indigo-700">
Einzelbild
</button>
<button id="modeGif" onclick="setMode('gif')"
class="py-3 px-4 rounded-xl border-2 transition font-medium border-gray-100 bg-gray-50 text-gray-500 hover:border-gray-200">
Animiertes GIF
</button>
</div>

<button id="generateBtn" onclick="startGeneration()"
class="w-full bg-black text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 transition transform active:scale-[0.98]">
Kunstwerk generieren
</button>

<div id="statusArea" class="hidden">
<div class="flex justify-between mb-2 text-sm font-medium">
<span id="statusText">Analysiere Artist...</span>
<span id="percentText">0%</span>
</div>
<div class="w-full bg-gray-100 rounded-full h-2.5">
<div id="progressBar"
class="bg-indigo-600 h-2.5 rounded-full transition-all duration-500"
style="width:0%">
</div>
</div>
</div>

<div id="errorArea"
class="hidden p-4 bg-red-50 text-red-600 rounded-xl text-sm border border-red-100 font-medium text-center">
</div>

<div id="resultArea" class="hidden mt-8 border-t pt-8 text-center">
<h3 class="text-lg font-bold mb-4">Dein generiertes Werk:</h3>
<img id="resultImage"
class="max-w-full rounded-lg shadow-lg border border-gray-200 mx-auto">
<div class="mt-4 flex justify-center gap-4">
<button id="downloadBtn"
class="bg-gray-100 hover:bg-gray-200 px-6 py-2 rounded-lg font-semibold text-sm transition">
Herunterladen
</button>
</div>
<p class="mt-4 text-xs text-gray-400 max-w-sm mx-auto">
Dieses Werk ist ein KI-generiertes Unikat, inspiriert durch die Metadaten des Künstlers.
</p>
</div>

</div>
</div>

<footer class="mt-12 text-center text-xs text-gray-400 uppercase tracking-widest leading-relaxed">
<p>• Nutzt Objkt GraphQL API & Pollinations.ai Open Source SDXL •</p>
<p>• Datenschutzkonform • Kostenlose Webapp by MNTG •</p>
</footer>

</div>

<script>
let currentMode='image';

function setMode(mode){
currentMode=mode;
document.getElementById('modeImage').className = mode==='image' ? 
"py-3 px-4 rounded-xl border-2 transition font-medium border-indigo-600 bg-indigo-50 text-indigo-700" :
"py-3 px-4 rounded-xl border-2 transition font-medium border-gray-100 bg-gray-50 text-gray-500 hover:border-gray-200";
document.getElementById('modeGif').className = mode==='gif' ? 
"py-3 px-4 rounded-xl border-2 transition font-medium border-indigo-600 bg-indigo-50 text-indigo-700" :
"py-3 px-4 rounded-xl border-2 transition font-medium border-gray-100 bg-gray-50 text-gray-500 hover:border-gray-200";
}

function updateProgress(percent,text){
document.getElementById('statusArea').classList.remove('hidden');
document.getElementById('progressBar').style.width=percent+'%';
document.getElementById('percentText').innerText=percent+'%';
document.getElementById('statusText').innerText=text;
}

function showError(msg){
const err=document.getElementById('errorArea');
err.innerText=msg;
err.classList.remove('hidden','error-blink');
void err.offsetWidth;
err.classList.add('error-blink');
document.getElementById('statusArea').classList.add('hidden');
}

async function startGeneration(){
let input=document.getElementById('artistUrl').value.trim();
const btn=document.getElementById('generateBtn');
document.getElementById('resultArea').classList.add('hidden');
document.getElementById('errorArea').classList.add('hidden');

if(!input){showError("Bitte Link oder Adresse eingeben.");return;}

input=input.replace(/\/$/,"");
let parts=input.split('/');
let address=parts.pop();

if(!address.startsWith("tz") && !address.startsWith("KT")){
showError("Ungültige Adresse.");
return;
}

btn.disabled=true;
btn.innerText="Verarbeite...";

try{
updateProgress(15,"Analysiere Objkt...");
const tokens=await fetchObjktData(address);

updateProgress(40,"Extrahiere Stilmerkmale...");
const prompt=createAdvancedPrompt(tokens);

if(currentMode==="image"){
updateProgress(70,"Generiere Bild...");
const img=await generateImageUrl(prompt);
displayResult(img);
}else{
updateProgress(60,"Generiere Frames...");
let frames=[];
for(let i=0;i<4;i++){
frames.push(await generateImageUrl(prompt+", Variation "+i));
}
updateProgress(95,"Erstelle GIF...");
createGif(frames);
}

}catch(e){
showError("Fehler: "+e.message);
}
finally{
btn.disabled=false;
btn.innerText="Kunstwerk generieren";
}
}

// ====================== FETCH ÜBER VERCEL-PROXY ======================
async function fetchObjktData(address){

const response = await fetch("/api/objkt", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ address })
});

if(!response.ok){
const err = await response.json().catch(()=>null);
throw new Error(err?.error || "Objkt API nicht erreichbar. Bitte später erneut versuchen.");
}

const json = await response.json();

if(!json.tokens){
throw new Error("Keine Daten von Objkt erhalten. Eventuell falsche Adresse.");
}

if(!json.tokens || json.tokens.length===0){
throw new Error("Keine Werke gefunden. Eventuell reiner Collector oder Collab.");
}

return json.tokens;
}

// ====================== PROMPT-FUNKTION ======================
function createAdvancedPrompt(tokens){
let textData="";
tokens.forEach(t=>{
textData+=(t.name||"")+" ";
textData+=(t.description||"")+" ";
if(t.tags && Array.isArray(t.tags)){textData+=t.tags.join(" ")+" ";}
if(t.metadata){
try{
let meta=typeof t.metadata==="string"?JSON.parse(t.metadata):t.metadata;
if(meta && meta.tags){textData+=meta.tags.join(" ")+" ";}
}catch{}
}
});
textData=textData.toLowerCase().replace(/[^\w\s]/g,"").split(/\s+/).filter(w=>w.length>3).slice(0,40).join(", ");
return `Hochwertiges, einzigartiges digitales Kunstwerk, inspiriert durch die visuelle Sprache von ${textData}, abstrakte Komposition, künstlerische Textur, einzigartig, transformativ, kein Text, kein Logo`;
}

async function generateImageUrl(prompt){
const seed=Math.floor(Math.random()*999999);
const url=`https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=512&height=512&seed=${seed}&nologo=true`;

await new Promise((res,rej)=>{
const img=new Image();
img.crossOrigin="anonymous";
img.onload=res;
img.onerror=rej;
img.src=url;
});

return url;
}

function createGif(images){
gifshot.createGIF({images:images,gifWidth:512,gifHeight:512,interval:0.45,numFrames:4},function(obj){
if(!obj.error){displayResult(obj.image);}else{showError("GIF-Erstellung fehlgeschlagen.");}
});
}

function displayResult(source){
updateProgress(100,"Fertig!");
document.getElementById('resultImage').src=source;
document.getElementById('resultArea').classList.remove('hidden');
document.getElementById('downloadBtn').onclick=()=>{
const link=document.createElement("a");
link.href=source;
link.download="mntg-style-"+Date.now()+".png";
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
};
}
</script>
</body>
</html>



